apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "logward.configMapName" . }}
  labels:
    {{- include "logward.labels" . | nindent 4 }}
data:
  NODE_ENV: {{ .Values.config.nodeEnv | quote }}
  LOG_LEVEL: {{ .Values.config.logLevel | quote }}

  # Rate Limiting
  RATE_LIMIT_AUTH: {{ .Values.config.rateLimit.auth | quote }}
  RATE_LIMIT_INGESTION: {{ .Values.config.rateLimit.ingestion | quote }}

  # Retention
  RETENTION_LOGS_DAYS: {{ .Values.config.retention.logs | quote }}
  RETENTION_ALERTS_DAYS: {{ .Values.config.retention.alerts | quote }}
  RETENTION_INCIDENTS_DAYS: {{ .Values.config.retention.incidents | quote }}

  # CORS
  {{- if .Values.config.corsOrigins }}
  CORS_ORIGINS: {{ .Values.config.corsOrigins | quote }}
  {{- else if .Values.ingress.enabled }}
  CORS_ORIGINS: "https://{{ (index .Values.ingress.hosts 0).host }}"
  {{- end }}

  # SMTP Configuration
  {{- if .Values.config.smtp.enabled }}
  SMTP_ENABLED: "true"
  SMTP_HOST: {{ .Values.config.smtp.host | quote }}
  SMTP_PORT: {{ .Values.config.smtp.port | quote }}
  SMTP_SECURE: {{ .Values.config.smtp.secure | quote }}
  SMTP_FROM: {{ .Values.config.smtp.from | quote }}
  {{- end }}
